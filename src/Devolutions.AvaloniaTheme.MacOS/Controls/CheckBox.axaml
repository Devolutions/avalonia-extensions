<ResourceDictionary
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:design="clr-namespace:Devolutions.AvaloniaTheme.MacOS.Design">

  <Design.PreviewWith>
    <design:ThemePreviewer>
      <StackPanel Margin="10">
        <CheckBox IsChecked="True">Emulate 3 buttons</CheckBox>
        <CheckBox IsChecked="False">Swap mouse bu</CheckBox>
        <CheckBox IsChecked="True" IsEnabled="False">Auto scale with</CheckBox>
        <CheckBox IsEnabled="False">Unchecked disabled </CheckBox>
        <CheckBox IsThreeState="True" IsChecked="{x:Null}">Unknown by default</CheckBox>
        <CheckBox IsThreeState="True" IsChecked="{x:Null}" IsEnabled="False">
          Indeterminate
        </CheckBox>
        <CheckBox Width="120">Checkbox should wrap its text</CheckBox>
      </StackPanel>
    </design:ThemePreviewer>
  </Design.PreviewWith>

  <ControlTheme x:Key="{x:Type CheckBox}" TargetType="CheckBox">
    <Setter Property="Foreground" Value="{DynamicResource ForegroundHighBrush}" />
    <Setter Property="Background" Value="{DynamicResource CheckBoxBackgroundBrush}" />
    <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}" />
    <Setter Property="BorderThickness" Value="{DynamicResource ControlBorderThickness}" />
    <Setter Property="VerticalAlignment" Value="Center" />
    <Setter Property="VerticalContentAlignment" Value="Center" />
    <Setter Property="HorizontalAlignment" Value="Left" />
    <Setter Property="HorizontalContentAlignment" Value="Left" />
    <Setter Property="CornerRadius" Value="{DynamicResource CheckBoxCornerRadius}" />
    <Setter Property="FontSize" Value="{DynamicResource ControlFontSize}" />
    <Setter Property="FocusAdorner" Value="{x:Null}" />
    <Setter Property="ClipToBounds" Value="False" />
    <Setter Property="Template">
      <ControlTemplate>
        <Panel Name="ReservedSpaceForFocus"
               Margin="{StaticResource InputControlsSpaceForFocusBorder}">
          <Grid ColumnDefinitions="Auto,5,*" MinHeight="20" ClipToBounds="False">
            <Border
              Name="FocusBorderElement"
              VerticalAlignment="Center"
              Margin="{StaticResource FocusBorderMargin}"
              BorderThickness="{StaticResource FocusBorderThickness}"
              CornerRadius="5">
              <Border
                Name="ControlBorder"
                Width="14"
                Height="14"
                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="{TemplateBinding CornerRadius}"
                BoxShadow="{DynamicResource ControlBackgroundRecessedShadow}">
                <Panel>
                  <Path
                    Name="CheckMark"
                    IsVisible="False"
                    Width="9"
                    Height="9"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Data="{DynamicResource CheckMarkPath}"
                    FlowDirection="LeftToRight"
                    Stretch="Fill"
                    Fill="{WindowActiveBindingToggler 
                        {DynamicResourceToggler {Binding $parent[CheckBox].IsEnabled}, ControlForegroundAccentHighBrush, ForegroundLowBrush}, 
                        {DynamicResourceToggler {Binding $parent[CheckBox].IsEnabled}, ControlForegroundAccentInactiveHighBrush, ForegroundLowBrush}}" />

                  <Rectangle
                    Name="IndeterminateMark"
                    IsVisible="False"
                    Width="8"
                    Height="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Stretch="Uniform"
                    Fill="{WindowActiveBindingToggler 
                        {DynamicResourceToggler {Binding $parent[CheckBox].IsEnabled}, ControlForegroundAccentHighBrush, ForegroundLowBrush}, 
                        {DynamicResourceToggler {Binding $parent[CheckBox].IsEnabled}, ControlForegroundAccentInactiveHighBrush, ForegroundLowBrush}}" />
                </Panel>
              </Border>
            </Border>
            <ContentPresenter
              Name="PART_ContentPresenter"
              Grid.Column="2"
              Margin="{TemplateBinding Padding}"
              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
              Content="{TemplateBinding Content}"
              ContentTemplate="{TemplateBinding ContentTemplate}"
              IsVisible="{TemplateBinding Content, Converter={x:Static ObjectConverters.IsNotNull}}"
              RecognizesAccessKey="True"
              TextWrapping="Wrap"
              TextElement.Foreground="{TemplateBinding Foreground}" />
          </Grid>
        </Panel>
      </ControlTemplate>
    </Setter>

    <!-- Tabbing focus -->
    <Style Selector="^:focus-visible">
      <Style Selector="^ /template/ Border#FocusBorderElement">
        <Setter Property="BorderBrush" Value="{DynamicResource FocusBorderBrush}" />
      </Style>
    </Style>

    <!--  Checked State  -->
    <Style Selector="^:checked">
      <Setter Property="Background" Value="{WindowActiveResourceToggler ControlBackgroundAccentRaisedBrush, ControlBackgroundHighBrush}" />
      <Style Selector="^/template/ Border#ControlBorder">
        <Setter Property="BorderBrush" Value="{WindowActiveResourceToggler ControlBorderAccentBrush, ControlBorderBrush}" />
        <Setter Property="BoxShadow" Value="0 0 Transparent" /> <!-- TODO: How do you set it to None? -->
      </Style>
      <Style Selector="^/template/ Path#CheckMark">
        <Setter Property="IsVisible" Value="True" />
      </Style>
    </Style>
    <Style Selector="^:indeterminate">
      <Setter Property="Background" Value="{WindowActiveResourceToggler ControlBackgroundAccentRaisedBrush, ControlBackgroundHighBrush}" />
      <Style Selector="^/template/ Border#ControlBorder">
        <Setter Property="BorderBrush" Value="{WindowActiveResourceToggler ControlBorderAccentBrush, ControlBorderBrush}" />
        <Setter Property="BoxShadow" Value="0 0 Transparent" /> <!-- TODO: How do you set it to None? -->
      </Style>
      <Style Selector="^/template/ Rectangle#IndeterminateMark">
        <Setter Property="IsVisible" Value="True" />
      </Style>
    </Style>

    <!--  Pressed State  -->
    <Style Selector="^:pressed">
      <Style Selector="^ /template/ Border#ControlBorder">
        <Setter Property="Background" Value="{DynamicResource CheckBoxPressedBackgroundBrush}" />
      </Style>
      <Style Selector="^:checked /template/ Border#ControlBorder">
        <Setter Property="Background" Value="{DynamicResource CheckBoxPressedCheckedBackgroundBrush}" />
      </Style>
    </Style>

    <!--  Disabled State  -->
    <Style Selector="^:disabled">
      <Setter Property="Background" Value="{DynamicResource ControlBackgroundDisabledHighBrush}" />
      <Style Selector="^/template/ Border#ControlBorder">
        <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderDisabledBrush}" />
      </Style>
      <Style Selector="^/template/ ContentPresenter#PART_ContentPresenter">
        <Setter Property="Foreground" Value="{DynamicResource ForegroundLowBrush}" />
      </Style>
      <Style Selector="^:checked">
        <Style Selector="^/template/ Border#ControlBorder">
          <Setter Property="BorderThickness" Value="{DynamicResource ControlBorderThickness}" />
          <Setter Property="BoxShadow" Value="{DynamicResource ControlBackgroundRecessedShadow}" />
        </Style>
        <Style Selector="^/template/ Path#CheckMark">
          <Setter Property="IsVisible" Value="True" />
          <!-- Fill is handled within the template since the WindowActive toggler will always override styles -->
        </Style>
      </Style>
      <Style Selector="^:indeterminate">
        <Style Selector="^/template/ Border#ControlBorder">
          <Setter Property="BorderThickness" Value="{DynamicResource ControlBorderThickness}" />
        </Style>
        <Style Selector="^/template/ Rectangle#IndeterminateMark">
          <Setter Property="IsVisible" Value="True" />
          <!-- Fill is handled within the template since the WindowActive toggler will always override styles -->
        </Style>
      </Style>
    </Style>
  </ControlTheme>
</ResourceDictionary>