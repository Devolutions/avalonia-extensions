<ResourceDictionary
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:design="clr-namespace:Devolutions.AvaloniaTheme.MacOS.Design"
  xmlns:system="clr-namespace:System;assembly=System.Runtime">

  <!-- 
    Un-comment to allow auto-completion;
    DO NOT INCLUDE WHEN PUBLISHING!
  -->
  <!-- <ResourceDictionary.MergedDictionaries> -->
  <!--   <ResourceInclude Source="/Accents/ThemeResources.axaml" /> -->
  <!-- </ResourceDictionary.MergedDictionaries> -->

  <Design.PreviewWith>
    <design:ThemePreviewer>
      <StackPanel Width="200" Height="400" Spacing="20" Margin="20">
        <EditableComboBox
          Width="200"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Watermark="test">
          <EditableComboBoxItem Value="test1" />
          <EditableComboBoxItem Value="test2" />
          <EditableComboBoxItem Value="test3" />
        </EditableComboBox>

        <EditableComboBox
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Watermark="test">
          <EditableComboBoxItem Value="test1" />
          <EditableComboBoxItem Value="test2" />
          <EditableComboBoxItem Value="test3" />
        </EditableComboBox>

        <EditableComboBox
          Width="200">
          <EditableComboBoxItem Value="gpt-5" />
          <EditableComboBoxItem Value="gpt-5-chat-latest" />
          <EditableComboBoxItem Value="gpt-5-mini" />
          <EditableComboBoxItem Value="gpt-4.1" />
          <EditableComboBoxItem Value="gpt-4.1-mini" />
        </EditableComboBox>

        <EditableComboBox
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          IsEnabled="False"
          Watermark="test">
          <EditableComboBoxItem Value="test" />
        </EditableComboBox>

        <EditableComboBox Value="Left and Right content" HorizontalAlignment="Center">
          <EditableComboBoxItem>A</EditableComboBoxItem>

          <EditableComboBox.InnerLeftContent>
            <Border Width="12" Height="12" Background="Green" />
          </EditableComboBox.InnerLeftContent>
          <EditableComboBox.InnerRightContent>
            <Border Width="12" Height="12" Background="Blue" />
          </EditableComboBox.InnerRightContent>
        </EditableComboBox>

        <EditableComboBox
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Watermark="Error">
          <DataValidationErrors.Error>
            <system:Exception>
              <x:Arguments>
                <x:String>Some error</x:String>
              </x:Arguments>
            </system:Exception>
          </DataValidationErrors.Error>
        </EditableComboBox>
      </StackPanel>
    </design:ThemePreviewer>
  </Design.PreviewWith>

  <Thickness x:Key="EditableComboBoxPadding">10,5,0,5</Thickness>
  <x:Double x:Key="EditableComboBoxMinWidth">100</x:Double>

  <!-- Need to override default height in EditableComboBox control -->
  <x:Double x:Key="EditableComboBoxHeight">24</x:Double>
  <x:Double x:Key="EditableComboBoxItemsHeight">22</x:Double>

  <ControlTheme x:Key="{x:Type EditableComboBoxItem}" TargetType="EditableComboBoxItem" BasedOn="{StaticResource {x:Type EditableComboBoxItem}}">
    <Setter Property="IsHitTestVisible" Value="True" />
    <Setter Property="Margin" Value="{DynamicResource ComboBoxItemMargin}" />
    <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
    <Setter Property="Padding" Value="{DynamicResource ComboBoxItemPadding}" />
    <Setter Property="Template">
      <ControlTemplate>
        <Border Name="PART_Background" Padding="{TemplateBinding Padding}">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Path Name="CheckMark"
                  Width="10"
                  Height="10"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Data="{DynamicResource CheckMarkPath}"
                  Fill="Transparent"
                  FlowDirection="LeftToRight"
                  Stretch="Fill" />
            <SearchHighlightTextBlock
              Name="PART_Text"
              Content="{TemplateBinding Value}"
              Search="{TemplateBinding FilterHighlightText}"
              VerticalAlignment="Center" />
          </StackPanel>
        </Border>
      </ControlTemplate>
    </Setter>
    <Style Selector="^ /template/ Border#PART_Background">
      <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
    </Style>

    <Style Selector="^[IsSelected=True]">
      <Style Selector="^ /template/ Path#CheckMark">
        <Setter Property="Fill" Value="{DynamicResource ForegroundHighBrush}" />
      </Style>
      <Style Selector="^ /template/ Border#PART_Background">
        <Setter Property="Background" Value="Transparent" />
      </Style>
    </Style>

    <Style Selector="^:pointerover">
      <Style Selector="^ /template/ Border#PART_Background">
        <Setter Property="Background" Value="{DynamicResource ControlBackgroundAccentRaisedBrush}" />
      </Style>
      <Style Selector="^[IsSelected=True] /template/ Path#CheckMark">
        <Setter Property="Fill" Value="{DynamicResource ControlForegroundAccentHighBrush}" />
      </Style>
      <Style Selector="^ /template/ SearchHighlightTextBlock#PART_Text">
        <Setter Property="Foreground" Value="{DynamicResource ControlForegroundAccentHighBrush}" />
        <Setter Property="HighlightForeground" Value="{DynamicResource ControlForegroundAccentHighBrush}" />
      </Style>
    </Style>
  </ControlTheme>

  <ControlTheme x:Key="{x:Type EditableComboBox+InnerComboBox}"
                TargetType="EditableComboBox+InnerComboBox">
    <Setter Property="FocusAdorner" Value="{x:Null}" />
    <Setter Property="MaxDropDownHeight" Value="504" />
    <Setter Property="Foreground"
            Value="{Binding Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="Background"
            Value="{Binding Background, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="CornerRadius"
            Value="{Binding CornerRadius, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="Padding"
            Value="{Binding Padding, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="MinHeight"
            Value="{Binding MinHeight, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="BorderThickness"
            Value="{Binding BorderThickness, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="BorderBrush"
            Value="{Binding BorderBrush, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="InnerLeftContent"
            Value="{Binding InnerLeftContent, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="InnerRightContent"
            Value="{Binding InnerRightContent, RelativeSource={RelativeSource FindAncestor, AncestorType=EditableComboBox}, Mode=OneWay}" />
    <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
    <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    <Setter Property="VerticalContentAlignment" Value="Center" />
    <Setter Property="HorizontalAlignment" Value="Stretch" />
    <Setter Property="VerticalAlignment" Value="Stretch" />
    <Setter Property="PlaceholderForeground" Value="{DynamicResource ComboBoxPlaceHolderForeground}" />

    <Setter Property="ClipToBounds" Value="False" />
    <Setter Property="Template">
      <ControlTemplate>
        <Panel Name="ReservedSpaceForFocus"
               ClipToBounds="False"
               Margin="{DynamicResource InputControlsSpaceForFocusBorder}">
          <DataValidationErrors ClipToBounds="False">
            <Panel ClipToBounds="False">
              <Border
                Name="BorderElement"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                BoxShadow="{DynamicResource ComboBoxBoxShadow}"
                CornerRadius="{TemplateBinding CornerRadius}"
                MinWidth="{TemplateBinding MinWidth}"
                MinHeight="{TemplateBinding MinHeight}"
                ZIndex="0" />

              <Border
                Name="BorderHighlightElement"
                Background="Transparent"
                BorderBrush="{DynamicResource ControlBorderRaisedBrush}"
                BorderThickness="{TemplateBinding BorderThickness, 
                Converter={x:Static DevoConverters.ThicknessExtractor}, 
                ConverterParameter={x:Static ThicknessSubset.Bottom}}"
                CornerRadius="{TemplateBinding CornerRadius}"
                MinWidth="{TemplateBinding MinWidth}"
                MinHeight="{TemplateBinding MinHeight}"
                ZIndex="1" />

              <Grid ColumnDefinitions="Auto,*,Auto,18" HorizontalAlignment="Stretch" ClipToBounds="False">
                <ItemsControl
                  Grid.Column="0"
                  Name="PART_InnerLeftContent"
                  ItemsSource="{TemplateBinding InnerLeftContent}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel Orientation="Horizontal" Margin="4 2 0 2" Spacing="2" />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                </ItemsControl>

                <ContentPresenter x:Name="PART_TextBoxPresenter" Grid.Column="1" />

                <!-- Background="{WindowActiveResourceToggler ControlBackgroundAccentRaisedBrush, ControlBackgroundRecessedBrush}"  -->

                <ItemsControl
                  Grid.Column="2"
                  Name="PART_InnerRightContent"
                  ItemsSource="{TemplateBinding InnerRightContent}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel Orientation="Horizontal" Margin="2" Spacing="2" />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                </ItemsControl>

                <Border
                  Name="DropDownGlyphBackground"
                  Grid.Column="3"
                  Width="16"
                  Height="16"
                  CornerRadius="{DynamicResource ControlCornerRadius}"
                  HorizontalAlignment="Right"
                  Margin="0 0 2 0"
                  VerticalAlignment="Center">
                  <PathIcon
                    Name="DropDownGlyph"
                    UseLayoutRounding="False"
                    IsHitTestVisible="False"
                    Height="8"
                    Width="9"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Foreground="{WindowActiveBindingToggler 
                        {DynamicResourceToggler {Binding $parent[EditableComboBox].IsEnabled}, ComboBoxChevronBrush, ForegroundLowBrush}, 
                        {DynamicResourceToggler {Binding $parent[EditableComboBox].IsEnabled}, ComboBoxChevronInactiveBrush, ForegroundLowBrush}}"
                    Data="{StaticResource ChevronPath}">
                    <PathIcon.RenderTransform>
                      <ScaleTransform ScaleY="-1" />
                    </PathIcon.RenderTransform>
                  </PathIcon>
                </Border>

                <Popup
                  Name="PART_Popup"
                  WindowManagerAddShadowHint="False"
                  IsOpen="{TemplateBinding IsDropDownOpen, Mode=TwoWay}"
                  MinWidth="{AddBinding
                                    {Binding Bounds.Width, RelativeSource={RelativeSource TemplatedParent}},
                                    24
                                }"
                  MaxHeight="{TemplateBinding MaxDropDownHeight}"
                  VerticalOffset="2"
                  HorizontalAlignment="Stretch"
                  IsLightDismissEnabled="True"
                  OverlayDismissEventPassThrough="True"
                  InheritsTransform="True"
                  ClipToBounds="False">
                  <Border
                    x:Name="PopupBorder"
                    Background="{DynamicResource PopupBackgroundBrush}"
                    BorderBrush="{DynamicResource MenuFlyoutPresenterBorderBrush}"
                    BorderThickness="{DynamicResource MenuFlyoutPresenterBorderThickness}"
                    Padding="{DynamicResource PopupPadding}"
                    HorizontalAlignment="Stretch"
                    BoxShadow="{DynamicResource PopupShadow}"
                    Margin="{DynamicResource PopupMargin}"
                    CornerRadius="{DynamicResource LayoutCornerRadius}">
                    <ScrollViewer
                      CornerRadius="{DynamicResource LayoutCornerRadius}"
                      HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
                      VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
                      IsDeferredScrollingEnabled="{TemplateBinding (ScrollViewer.IsDeferredScrollingEnabled)}">
                      <ItemsPresenter
                        Name="PART_ItemsPresenter"
                        Margin="{DynamicResource AutoCompleteListPadding}"
                        ItemsPanel="{TemplateBinding ItemsPanel}">
                        <ItemsPresenter.Styles>
                          <Style Selector="StackPanel">
                            <Setter Property="Spacing" Value="1" />
                          </Style>
                        </ItemsPresenter.Styles>
                      </ItemsPresenter>
                    </ScrollViewer>
                  </Border>
                </Popup>
              </Grid>

              <Border Name="FocusBorderElement"
                      Margin="{StaticResource FocusBorderMargin}"
                      BorderThickness="{StaticResource FocusBorderThickness}"
                      CornerRadius="7" />
            </Panel>
          </DataValidationErrors>
        </Panel>
      </ControlTemplate>
    </Setter>

    <Style Selector="^ /template/ Border#DropDownGlyphBackground">
      <Setter Property="Background" Value="{WindowActiveResourceToggler ComboBoxButtonBackgroundBrush, ComboBoxButtonInactiveBackgroundBrush}" />
      <Setter Property="BorderBrush" Value="{WindowActiveResourceToggler ComboBoxButtonBorderBrush, ComboBoxButtonInactiveBorderBrush}" />
      <Setter Property="BorderThickness" Value="{DynamicResource ComboBoxButtonBorderThickness}" />
    </Style>

    <!-- Error State -->
    <Style Selector="^:error /template/ Border#Background">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextForegroundBrush}" />
    </Style>

    <!--  Focused State  -->
    <Style Selector="^:focus-within">
      <Style Selector="^ /template/ Border#FocusBorderElement">
        <Setter Property="BorderBrush" Value="{DynamicResource FocusBorderBrush}" />
        <Setter Property="BorderThickness" Value="{StaticResource FocusBorderThickness}" />
        <Setter Property="CornerRadius" Value="7" />
      </Style>
    </Style>

    <Style Selector="^:focus-visible">
      <Style Selector="^ /template/ Border#FocusBorderElement">
        <Setter Property="BorderBrush" Value="{DynamicResource FocusBorderBrush}" />
        <Setter Property="BorderThickness" Value="{StaticResource FocusBorderThickness}" />
        <Setter Property="CornerRadius" Value="7" />
      </Style>
    </Style>

    <Style Selector="^ /template/ Border#DropDownGlyphBackground:pointerover">
      <Setter Property="Opacity" Value="0.95" />
    </Style>

    <Style Selector="^:dropdownopen">
      <Style Selector="^ /template/ Border#DropDownGlyphBackground">
        <Setter Property="Opacity" Value="0.9" />
      </Style>
    </Style>

    <!--  Disabled State  -->
    <Style Selector="^:disabled">
      <Style Selector="^ /template/ Border#Background">
        <Setter Property="Background" Value="{DynamicResource ComboBoxBackgroundDisabled}" />
        <Setter Property="BorderBrush" Value="{DynamicResource ComboBoxBorderBrushDisabled}" />
      </Style>
      <Style Selector="^ /template/ PathIcon#DropDownGlyph">
        <Setter Property="Foreground" Value="{DynamicResource ComboBoxDropDownGlyphForegroundDisabled}" />
      </Style>
      <Style Selector="^ /template/ Border#DropDownGlyphBackground">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderBrush" Value="Transparent" />
      </Style>
    </Style>
  </ControlTheme>

  <ControlTheme x:Key="{x:Type EditableComboBox}" TargetType="EditableComboBox" BasedOn="{StaticResource {x:Type EditableComboBox}}">
    <Setter Property="Foreground" Value="{DynamicResource ForegroundHighBrush}" />
    <Setter Property="Background" Value="{DynamicResource TextBoxBackgroundBrush}" />
    <Setter Property="HorizontalAlignment" Value="Stretch" />
    <Setter Property="VerticalAlignment" Value="Center" />
    <Setter Property="MinHeight" Value="20" />
    <Setter Property="CaretBrush" Value="{DynamicResource SystemAccentColor}" />
    <Setter Property="SelectionBrush" Value="{DynamicResource TextBoxSelectionHighlightBrush}" />
    <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
    <Setter Property="BorderBrush" Value="{DynamicResource TextBoxBorderBrush}" />
    <Setter Property="BorderThickness" Value="{DynamicResource TextBoxBorderThickness}" />
    <Setter Property="Padding" Value="4 0 2 0" />
    <Setter Property="FontSize" Value="{StaticResource ControlFontSize}" />
    <Setter Property="ClipToBounds" Value="False" />

    <Style Selector="^:error">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextForegroundBrush}" />
    </Style>
  </ControlTheme>
</ResourceDictionary>